<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CYBERIA</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0f172a; color: white; overflow: hidden; touch-action: none; }
        .card-hover:hover { transform: translateY(-10px); z-index: 50; }
        .card-transition { transition: all 0.3s ease; }
        
        /* Custom Soft Pulse agar kedipan tidak terlalu transparan */
        @keyframes soft-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }
        .animate-soft-pulse {
            animation: soft-pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Hide scrollbar for mobile swipe (Hand Container) */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Custom Scrollbar for Logs & Modals */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- DATABASE KARTU ---
        const CARD_TYPES = {
            ATTACK: 'ATTACK',
            DEFENSE: 'DEFENSE',
            WISDOM: 'WISDOM'
        };

        const CATEGORIES = {
            AGRESI: 'Agresi Verbal',
            IDENTITAS: 'Identitas',
            MANIPULASI: 'Manipulasi',
            PENGUCILAN: 'Pengucilan',
            PROVOKASI: 'Provokasi'
        };

        const CARD_DB = [
            // AGRESI VERBAL
            { id: 'a1', name: 'Flaming', type: CARD_TYPES.ATTACK, category: CATEGORIES.AGRESI, value: 30, desc: 'Mengirim pesan penuh amarah dan makian di kolom komentar atau chat untuk memancing keributan.', color: 'bg-red-600' },
            { id: 'a2', name: 'Insulting', type: CARD_TYPES.ATTACK, category: CATEGORIES.AGRESI, value: 30, desc: 'Mengolok-olok kekurangan fisik, penampilan, atau kemampuan seseorang (Body Shaming).', color: 'bg-red-600' },
            { id: 'a3', name: 'Spamming Hate', type: CARD_TYPES.ATTACK, category: CATEGORIES.AGRESI, value: 20, desc: 'Membanjiri notifikasi seseorang dengan pesan kebencian berulang-ulang hingga mengganggu.', color: 'bg-red-500' },
            { id: 'a4', name: 'Threatening', type: CARD_TYPES.ATTACK, category: CATEGORIES.AGRESI, value: 50, desc: 'Mengancam akan menyakiti fisik, mendatangi rumah korban, atau membahayakan nyawa.', color: 'bg-red-700' },
            { id: 'a5', name: 'Slurring', type: CARD_TYPES.ATTACK, category: CATEGORIES.AGRESI, value: 40, desc: 'Menggunakan kata-kata kasar yang menghina suku, ras, agama, atau golongan tertentu (SARA).', color: 'bg-red-600' },
            { id: 'a6', name: 'Mocking', type: CARD_TYPES.ATTACK, category: CATEGORIES.AGRESI, value: 20, desc: 'Menertawakan kegagalan, kesedihan, atau musibah yang dialami orang lain sebagai bahan lelucon.', color: 'bg-red-500' },

            // IDENTITAS
            { id: 'a7', name: 'Impersonation', type: CARD_TYPES.ATTACK, category: CATEGORIES.IDENTITAS, value: 40, desc: 'Membuat akun palsu memakai nama dan foto teman untuk menipu orang lain atau merusak reputasi.', color: 'bg-rose-600' },
            { id: 'a8', name: 'Account Hijack', type: CARD_TYPES.ATTACK, category: CATEGORIES.IDENTITAS, value: 50, desc: 'Mencuri kata sandi dan mengambil alih akun orang lain untuk disalahgunakan.', color: 'bg-rose-700' },
            { id: 'a9', name: 'Doxing', type: CARD_TYPES.ATTACK, category: CATEGORIES.IDENTITAS, value: 50, desc: 'Menyebarkan data pribadi seperti nomor HP, alamat rumah, atau sekolah teman tanpa izin.', color: 'bg-rose-700' },
            { id: 'a10', name: 'Catfishing', type: CARD_TYPES.ATTACK, category: CATEGORIES.IDENTITAS, value: 30, desc: 'Menyamar menjadi orang lain (biasanya profil menarik) untuk menipu atau menjebak korban secara emosional.', color: 'bg-rose-600' },
            { id: 'a11', name: 'Stalking', type: CARD_TYPES.ATTACK, category: CATEGORIES.IDENTITAS, value: 30, desc: 'Memantau gerak-gerik online seseorang secara obsesif, menakutkan, dan mengganggu privasi.', color: 'bg-rose-600' },
            { id: 'a12', name: 'Privacy Breach', type: CARD_TYPES.ATTACK, category: CATEGORIES.IDENTITAS, value: 40, desc: 'Mengintip isi chat pribadi (DM) orang lain dan menyebarkannya ke publik (Screenshot Sebar).', color: 'bg-rose-600' },

            // MANIPULASI
            { id: 'a13', name: 'Shaming Photo', type: CARD_TYPES.ATTACK, category: CATEGORIES.MANIPULASI, value: 30, desc: 'Mengunggah foto memalukan teman tanpa persetujuan untuk mempermalukannya secara visual.', color: 'bg-pink-600' },
            { id: 'a14', name: 'Meme-ing', type: CARD_TYPES.ATTACK, category: CATEGORIES.MANIPULASI, value: 20, desc: 'Mengedit foto teman menjadi lelucon atau meme yang merendahkan harga dirinya.', color: 'bg-pink-500' },
            { id: 'a15', name: 'Deepfake', type: CARD_TYPES.ATTACK, category: CATEGORIES.MANIPULASI, value: 50, desc: 'Mengubah foto/video teman seolah melakukan hal buruk/asusila menggunakan AI atau editing canggih.', color: 'bg-pink-700' },
            { id: 'a16', name: 'Live Shaming', type: CARD_TYPES.ATTACK, category: CATEGORIES.MANIPULASI, value: 40, desc: 'Melakukan live streaming khusus untuk membicarakan keburukan atau aib orang lain kepada follower.', color: 'bg-pink-600' },
            { id: 'a17', name: 'Status Mockery', type: CARD_TYPES.ATTACK, category: CATEGORIES.MANIPULASI, value: 20, desc: 'Membuat status atau story yang menyindir secara spesifik (nyinyir) untuk memancing reaksi publik.', color: 'bg-pink-500' },
            { id: 'a18', name: 'Video Mocking', type: CARD_TYPES.ATTACK, category: CATEGORIES.MANIPULASI, value: 40, desc: 'Merekam diam-diam teman yang sedang melakukan kesalahan atau kecelakaan lalu mengunggahnya.', color: 'bg-pink-600' },

            // PENGUCILAN
            { id: 'a19', name: 'Group Kick-out', type: CARD_TYPES.ATTACK, category: CATEGORIES.PENGUCILAN, value: 20, desc: 'Sengaja mengeluarkan satu orang dari grup chat kelas atau pertemanan tanpa alasan yang jelas.', color: 'bg-purple-500' },
            { id: 'a20', name: 'Silent Treat', type: CARD_TYPES.ATTACK, category: CATEGORIES.PENGUCILAN, value: 30, desc: 'Mengajak orang lain untuk kompak mengabaikan pesan, sapaan, atau keberadaan satu orang.', color: 'bg-purple-600' },
            { id: 'a21', name: 'Blacklisting', type: CARD_TYPES.ATTACK, category: CATEGORIES.PENGUCILAN, value: 20, desc: 'Menghasut orang lain agar tidak mem-follow, berteman, atau berinteraksi dengan seseorang.', color: 'bg-purple-500' },
            { id: 'a22', name: 'Exclusion', type: CARD_TYPES.ATTACK, category: CATEGORIES.PENGUCILAN, value: 10, desc: 'Sengaja tidak mengajak teman tertentu saat bermain game online (mabar) atau aktivitas grup lainnya.', color: 'bg-purple-400' },
            { id: 'a23', name: 'Hate Campaign', type: CARD_TYPES.ATTACK, category: CATEGORIES.PENGUCILAN, value: 50, desc: 'Mengajak orang banyak melakukan \'Cancel Culture\' atau membenci seseorang tanpa dasar yang kuat.', color: 'bg-purple-700' },
            { id: 'a24', name: 'Voting Bully', type: CARD_TYPES.ATTACK, category: CATEGORIES.PENGUCILAN, value: 30, desc: 'Membuat polling di media sosial untuk memilih \'siapa yang paling tidak disukai\' atau \'paling aneh\' di kelas.', color: 'bg-purple-600' },

            // PROVOKASI
            { id: 'a25', name: 'Hoax Spreading', type: CARD_TYPES.ATTACK, category: CATEGORIES.PROVOKASI, value: 40, desc: 'Menyebarkan berita bohong atau fitnah agar seseorang dibenci oleh lingkungan sosialnya.', color: 'bg-fuchsia-600' },
            { id: 'a26', name: 'Cyber-baiting', type: CARD_TYPES.ATTACK, category: CATEGORIES.PROVOKASI, value: 30, desc: 'Memprovokasi guru atau teman agar marah saat kelas online, lalu merekam reaksinya untuk dipermalukan.', color: 'bg-fuchsia-600' },
            { id: 'a27', name: 'Griefing', type: CARD_TYPES.ATTACK, category: CATEGORIES.PROVOKASI, value: 10, desc: 'Sengaja merusak hasil karya, bangunan, atau progres game teman hanya untuk kesenangan pribadi.', color: 'bg-fuchsia-400' },
            { id: 'a28', name: 'Dogpiling', type: CARD_TYPES.ATTACK, category: CATEGORIES.PROVOKASI, value: 50, desc: 'Ikut-ikutan menghujat orang yang sedang viral (keroyokan) tanpa mengetahui duduk permasalahan sebenarnya.', color: 'bg-fuchsia-700' },
            { id: 'a29', name: 'False Report', type: CARD_TYPES.ATTACK, category: CATEGORIES.PROVOKASI, value: 40, desc: 'Melaporkan akun teman secara massal (mass report) ke platform padahal dia tidak melakukan kesalahan.', color: 'bg-fuchsia-600' },
            { id: 'a30', name: 'Peer Pressure', type: CARD_TYPES.ATTACK, category: CATEGORIES.PROVOKASI, value: 40, desc: 'Memaksa teman melakukan challenge berbahaya atau memalukan demi pengakuan dalam pertemanan.', color: 'bg-fuchsia-600' },

            // DEFENSES (ACTION TOOLS)
            { id: 'd1', name: 'Kartu Lapor', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.PROVOKASI, CATEGORIES.IDENTITAS], desc: 'Melaporkan konten atau akun jahat ke pihak aplikasi (Instagram/TikTok/Game) agar ditindaklanjuti.', color: 'bg-emerald-600' },
            { id: 'd2', name: 'Kartu Blokir', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.AGRESI, CATEGORIES.PENGUCILAN], desc: 'Memutuskan akses komunikasi total. Pelaku tidak bisa lagi melihat profil, mengirim pesan, atau menandaimu.', color: 'bg-teal-600' },
            { id: 'd3', name: 'Kartu Privasi', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.MANIPULASI, CATEGORIES.IDENTITAS], desc: 'Mengatur akun menjadi \'Private\', membatasi siapa yang bisa komentar, dan menyaring kata kasar otomatis.', color: 'bg-emerald-500' },
            { id: 'd4', name: 'Screenshot', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.AGRESI, CATEGORIES.PROVOKASI], desc: 'Mengambil tangkapan layar bukti chat atau komentar jahat sebelum dihapus pelaku, untuk barang bukti laporan.', color: 'bg-cyan-600' },
            { id: 'd5', name: 'Restrict', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.AGRESI, CATEGORIES.MANIPULASI], desc: 'Membatasi interaksi akun pengganggu tanpa mereka tahu (Shadowban). Komentar mereka hanya terlihat oleh mereka sendiri.', color: 'bg-teal-500' },
            { id: 'd6', name: 'Turn Off Comm', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.AGRESI, CATEGORIES.PROVOKASI], desc: 'Mematikan kolom komentar pada postingan tertentu untuk menghentikan perdebatan atau ujaran kebencian.', color: 'bg-cyan-500' },
            { id: 'd7', name: 'Pass Protect', type: CARD_TYPES.DEFENSE, counters: [CATEGORIES.IDENTITAS], desc: 'Mengganti kata sandi secara berkala dan mengaktifkan 2FA agar akun tidak mudah dibajak orang lain.', color: 'bg-emerald-700' },

            // WISDOM (HEALING)
            { id: 'w1', name: 'Kartu Support', type: CARD_TYPES.WISDOM, value: 20, desc: 'Memberi semangat dan dukungan kepada korban bullying agar mereka tidak merasa sendirian.', color: 'bg-yellow-500' },
            { id: 'w2', name: 'Verifikasi', type: CARD_TYPES.WISDOM, value: 20, desc: 'Mengecek kebenaran sebuah berita atau informasi sebelum emosi terpancing dan ikut menyebarkannya.', color: 'bg-amber-400' },
            { id: 'w3', name: 'Literasi', type: CARD_TYPES.WISDOM, value: 20, desc: 'Memahami aturan komunitas dan berhenti menyebarkan konten yang belum tentu benar atau bermanfaat.', color: 'bg-yellow-600' },
            { id: 'w4', name: 'Think First', type: CARD_TYPES.WISDOM, value: 15, desc: 'T.H.I.N.K (True, Helpful, Inspiring, Necessary, Kind). Pikirkan 5 hal ini sebelum memposting sesuatu.', color: 'bg-amber-500' },
            { id: 'w5', name: 'Digital Detox', type: CARD_TYPES.WISDOM, value: 40, desc: 'Beristirahat sejenak dari media sosial untuk menjaga kesehatan mental dan menikmati dunia nyata.', color: 'bg-yellow-400' },
            { id: 'w6', name: 'Berani Bicara', type: CARD_TYPES.WISDOM, value: 30, desc: 'Melaporkan kejadian bullying yang dialami atau dilihat kepada orang dewasa tepercaya (Orang tua/Guru).', color: 'bg-amber-600' },
            { id: 'w7', name: 'Kartu Pause', type: CARD_TYPES.WISDOM, value: 15, desc: 'Mengambil jeda 10 detik saat emosi memuncak sebelum menekan tombol kirim pada pesan atau komentar.', color: 'bg-yellow-500' },
            { id: 'w8', name: 'Netizen Hijau', type: CARD_TYPES.WISDOM, value: 25, desc: 'Secara aktif memberikan komentar positif dan apresiasi pada karya teman untuk membangun lingkungan sehat.', color: 'bg-lime-500' }
        ];

        // --- UTILS ---
        const generateDeck = () => {
            let deck = [];
            for(let i=0; i<2; i++) {
                CARD_DB.forEach(card => {
                    deck.push({ ...card, uniqueId: Math.random().toString(36).substr(2, 9) });
                });
            }
            return deck.sort(() => Math.random() - 0.5);
        };

        // --- COMPONENTS ---
        // Ukuran kartu dioptimalkan dan menggunakan file gambar (.png) dengan Fallback UI
        const Card = ({ card, onClick, disabled, hidden }) => {
            const [imgError, setImgError] = React.useState(false);

            if (hidden) {
                return (
                    <div className={`w-20 h-28 sm:w-24 sm:h-36 md:w-32 md:h-48 flex items-center justify-center card-transition flex-shrink-0 drop-shadow-lg ${imgError ? 'bg-slate-800 border-2 border-slate-600 rounded-xl' : ''}`}>
                        <img 
                            src="Cover.png" 
                            alt="Cover" 
                            className={`w-full h-full object-contain pointer-events-none ${imgError ? 'hidden' : 'block'}`} 
                            draggable="false" 
                            onError={() => setImgError(true)} 
                        />
                        {imgError && (
                            <div className="w-14 h-22 sm:w-16 sm:h-28 md:w-24 md:h-40 border border-slate-700 rounded-lg flex items-center justify-center opacity-50 bg-slate-900 overflow-hidden">
                                <span className="text-slate-500 font-bold tracking-[0.2em] md:tracking-widest text-[10px] sm:text-xs md:text-lg transform -rotate-90 md:rotate-0">CYB</span>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div 
                    onClick={() => !disabled && onClick(card)}
                    className={`w-24 h-36 sm:w-32 sm:h-48 md:w-36 md:h-52 flex flex-col card-transition flex-shrink-0 drop-shadow-xl ${disabled ? 'opacity-50 cursor-not-allowed' : 'card-hover cursor-pointer'} ${imgError ? card.color + ' rounded-xl border border-slate-900 overflow-hidden' : ''}`}
                >
                    <img 
                        src={`${card.name}.png`} 
                        alt={card.name} 
                        className={`w-full h-full object-contain pointer-events-none ${imgError ? 'hidden' : 'block'}`} 
                        draggable="false"
                        onError={() => setImgError(true)}
                    />
                    
                    {imgError && (
                        <React.Fragment>
                            <div className="px-1.5 sm:px-2 py-1 sm:py-1 bg-black bg-opacity-40 text-[9px] sm:text-[11px] font-bold truncate">
                                {card.name}
                            </div>
                            <div className="flex-1 p-1 flex flex-col items-center justify-center text-center bg-white bg-opacity-10 backdrop-blur-sm">
                                {card.type === CARD_TYPES.ATTACK && <span className="text-2xl sm:text-3xl mb-0.5">‚öîÔ∏è</span>}
                                {card.type === CARD_TYPES.DEFENSE && <span className="text-2xl sm:text-3xl mb-0.5">üõ°Ô∏è</span>}
                                {card.type === CARD_TYPES.WISDOM && <span className="text-2xl sm:text-3xl mb-0.5">üíñ</span>}
                                <p className="text-[7px] sm:text-[9px] md:text-[10px] font-medium drop-shadow-md leading-tight line-clamp-3 md:line-clamp-4">{card.desc}</p>
                            </div>
                            {card.type === CARD_TYPES.DEFENSE && (
                                 <div className="px-1.5 py-0.5 bg-black bg-opacity-60 text-[6px] sm:text-[8px] text-center leading-tight truncate">
                                    Anti: {card.counters.join(', ')}
                                </div>
                            )}
                            <div className="px-1.5 py-1 sm:py-1.5 bg-black bg-opacity-40 text-[8px] sm:text-[10px] flex justify-between font-bold">
                                <span>{card.type.substring(0,3)}</span>
                                {card.value && <span>{card.type === CARD_TYPES.ATTACK ? `-${card.value}` : `+${card.value}`}</span>}
                            </div>
                        </React.Fragment>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [playerMH, setPlayerMH] = React.useState(100);
            const [aiMH, setAiMH] = React.useState(100);
            const [deck, setDeck] = React.useState([]);
            const [playerHand, setPlayerHand] = React.useState([]);
            const [aiHand, setAiHand] = React.useState([]);
            const [turn, setTurn] = React.useState('PLAYER'); // PLAYER, AI, COUNTER
            const [logs, setLogs] = React.useState(['Mulai bertahan! Kalahkan serangan mental AI.']);
            const [pendingAttack, setPendingAttack] = React.useState(null);
            const [gameOver, setGameOver] = React.useState(false);
            const [showHelp, setShowHelp] = React.useState(false);
            const [defenseError, setDefenseError] = React.useState(null);
            const [winText, setWinText] = React.useState(''); // State baru untuk menyimpan kata-kata moral

            React.useEffect(() => {
                const initialDeck = generateDeck();
                setPlayerHand(initialDeck.splice(0, 5));
                setAiHand(initialDeck.splice(0, 5));
                setDeck(initialDeck);
            }, []);

            const addLog = (msg) => setLogs(prev => [msg, ...prev].slice(0, 8));

            const drawCard = (isPlayer) => {
                if (deck.length === 0) return;
                const newDeck = [...deck];
                const card = newDeck.pop();
                setDeck(newDeck);
                
                if (isPlayer && playerHand.length < 6) setPlayerHand([...playerHand, card]);
                else if (!isPlayer && aiHand.length < 6) setAiHand([...aiHand, card]);
            };

            const processAITurn = () => {
                setTimeout(() => {
                    drawCard(false);
                    if(aiHand.length === 0) { setTurn('PLAYER'); return; }

                    // --- SMART AI LOGIC ---
                    let playedIndex = -1;
                    
                    // 1. Jika kesehatan mental AI kurang dari 70, prioritaskan Healing (WISDOM)
                    if (aiMH < 70) {
                        const wisdomIndexes = aiHand.map((c, i) => c.type === CARD_TYPES.WISDOM ? i : -1).filter(i => i !== -1);
                        if (wisdomIndexes.length > 0) {
                            // Pilih kartu healing dengan efek terbesar
                            playedIndex = wisdomIndexes.reduce((maxIdx, currentIdx) => 
                                aiHand[currentIdx].value > aiHand[maxIdx].value ? currentIdx : maxIdx
                            , wisdomIndexes[0]);
                        }
                    }

                    // 2. Jika tidak butuh healing atau tidak ada kartu healing, cari kartu ATTACK (Serangan)
                    if (playedIndex === -1) {
                        const attackIndexes = aiHand.map((c, i) => c.type === CARD_TYPES.ATTACK ? i : -1).filter(i => i !== -1);
                        if (attackIndexes.length > 0) {
                            // Pilih serangan dengan damage tertinggi agar mematikan
                            playedIndex = attackIndexes.reduce((maxIdx, currentIdx) => 
                                aiHand[currentIdx].value > aiHand[maxIdx].value ? currentIdx : maxIdx
                            , attackIndexes[0]);
                        }
                    }

                    // 3. Jika tidak ada WISDOM atau ATTACK, pilih kartu sembarang (biasanya membuang kartu Defense)
                    if (playedIndex === -1) {
                        playedIndex = Math.floor(Math.random() * aiHand.length);
                    }

                    const playedCard = aiHand[playedIndex];
                    const newAiHand = aiHand.filter((_, i) => i !== playedIndex);
                    setAiHand(newAiHand);
                    // ----------------------

                    if (playedCard.type === CARD_TYPES.ATTACK) {
                        setPendingAttack(playedCard);
                        setTurn('COUNTER'); 
                        addLog(`‚ö†Ô∏è ALERT! AI menyerang dengan jahat menggunakan ${playedCard.name}! Segera tangkis!`);
                    } else if (playedCard.type === CARD_TYPES.WISDOM) {
                        setAiMH(prev => Math.min(100, prev + playedCard.value));
                        addLog(`ü§ñ AI meregenerasi sistem dengan ${playedCard.name}. (Pulih +${playedCard.value} MH)`);
                        setTurn('PLAYER');
                    } else {
                        addLog(`üõ°Ô∏è AI mengaktifkan protokol pertahanan: ${playedCard.name}.`);
                        setTurn('PLAYER');
                    }
                }, 1200);
            };

            const playCard = (card, index) => {
                if (turn !== 'PLAYER' && turn !== 'COUNTER') return;
                const newHand = playerHand.filter((_, i) => i !== index);

                if (turn === 'COUNTER') {
                    if (card.type === CARD_TYPES.DEFENSE && card.counters.includes(pendingAttack.category)) {
                        addLog(`üõ°Ô∏è LUAR BIASA! Serangan dipatahkan berkat ${card.name}!`);
                        setPlayerHand(newHand);
                        setPendingAttack(null);
                        setDefenseError(null);
                        setTurn('PLAYER');
                    } else {
                        const errorMsg = `‚ùå GAGAL! Pertahanan ${card.name} tembus! Bukan penangkal yang tepat.`;
                        addLog(errorMsg);
                        setDefenseError(errorMsg);
                        // Hilangkan pesan error dari layar setelah 2.5 detik
                        setTimeout(() => setDefenseError(null), 2500);
                    }
                    return;
                }

                setPlayerHand(newHand);

                if (card.type === CARD_TYPES.ATTACK) {
                    const newAiMH = aiMH - card.value;
                    setAiMH(newAiMH);
                    addLog(`üí• BOOM! Kamu membalas dengan ${card.name}! AI kena mental -${card.value} MH.`);
                    if (newAiMH <= 0) { 
                        // Kumpulan variasi pesan moral saat pemain "menang"
                        const winMessages = [
                            "Kamu memenangkan simulasi ini, tapi dengan menghancurkan mental lawan hingga tak tersisa. Di dunia nyata, membalas kejahatan dengan kekejaman membuatmu tak ada bedanya dengan pembully itu sendiri.",
                            "Sistem AI tumbang. Namun sadarkah kamu? Mengalahkan perilaku toxic dengan serangan yang sama toxic-nya hanya akan melahirkan pelaku baru. Membalas dendam bukanlah keadilan.",
                            "Kemenangan mutlak... Tapi ingat, di dunia nyata, menghancurkan mental seseorang demi kepuasan balas dendam adalah tindakan yang sama jahatnya. Menang tanpa menjatuhkan adalah kemenangan sejati.",
                            "AI hancur berkeping-keping. Kamu selamat dengan cara membalas rasa sakit dengan rasa sakit. Namun, membalas cyberbullying dengan bullying balasan tidak akan pernah menyelesaikan masalah.",
                            "Selamat, kamu bertahan. Namun lihatlah sisa-sisa kehancuran mental lawanmu. Jika kamu meniru cara mereka menyakitimu, apa bedanya dirimu dengan para pembully tersebut?"
                        ];
                        // Pilih salah satu pesan secara acak
                        setWinText(winMessages[Math.floor(Math.random() * winMessages.length)]);
                        setGameOver('PLAYER_WIN'); 
                        return; 
                    }
                } else if (card.type === CARD_TYPES.WISDOM) {
                    setPlayerMH(prev => Math.min(100, prev + card.value));
                    addLog(`‚ú® Tenang sejenak... ${card.name} memberimu kekuatan +${card.value} MH.`);
                } else if (card.type === CARD_TYPES.DEFENSE) {
                    addLog(`üõ°Ô∏è Kamu bersiap siaga dengan memasang ${card.name}.`);
                }

                setTurn('AI');
                processAITurn();
            };

            const skipCounter = () => {
                if (pendingAttack) {
                    const newPlayerMH = playerMH - pendingAttack.value;
                    setPlayerMH(newPlayerMH);
                    addLog(`üíî Ouch! Pertahanan jebol oleh ${pendingAttack.name}! Kamu kehilangan -${pendingAttack.value} MH.`);
                    setPendingAttack(null);
                    setDefenseError(null);
                    if (newPlayerMH <= 0) setGameOver('AI_WIN');
                    else setTurn('PLAYER');
                }
            };

            const endTurn = () => {
                if(turn === 'PLAYER') {
                    addLog("Giliran berakhir.");
                    setTurn('AI');
                    processAITurn();
                }
            };

            if (gameOver) {
                return (
                    <div className="flex flex-col items-center justify-center h-[100dvh] bg-slate-900 text-white p-4">
                        <h1 className={`text-3xl md:text-5xl font-black mb-2 text-center ${gameOver === 'PLAYER_WIN' ? 'text-yellow-500' : 'text-red-500'}`}>
                            {gameOver === 'PLAYER_WIN' ? 'SIMULASI SELESAI' : 'üíÄ MENTAL HABIS üíÄ'}
                        </h1>
                        
                        {gameOver === 'PLAYER_WIN' && (
                            <h2 className="text-xl md:text-2xl font-bold mb-6 text-emerald-400 text-center">
                                Kamu Menang, Tapi...
                            </h2>
                        )}

                        <p className="text-sm md:text-lg mb-8 text-center max-w-2xl text-slate-300 italic leading-relaxed px-4">
                            {gameOver === 'PLAYER_WIN' ? `"${winText}"` : 'Jangan menyerah. Di dunia nyata, segera cari dukungan (Kartu Support) atau Berani Bicara.'}
                        </p>
                        
                        <button onClick={() => window.location.reload()} className="px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-lg font-bold shadow-lg">
                            Mulai Simulasi Baru
                        </button>
                    </div>
                );
            }

            // h-[100dvh] dan overflow-hidden MENGUNCI aplikasi agar seukuran layar utuh
            return (
                <div className="flex flex-col h-[100dvh] w-full max-w-md md:max-w-4xl mx-auto px-2 py-2 overflow-hidden bg-slate-900 select-none">
                    
                    {/* Header - Fixed Shrink-0 */}
                    <div className="flex justify-between items-center bg-slate-800 p-2 rounded-xl border border-slate-700 shadow-md shrink-0">
                        <div className="flex flex-col leading-tight">
                            <h1 className="text-lg md:text-2xl font-black bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-400 tracking-wider">
                                CYBERIA
                            </h1>
                            <span className="text-[7px] md:text-[10px] text-slate-400 italic">Eksplorasi Internet Aman</span>
                        </div>
                        <div className="flex gap-2 items-center">
                            <div className={`px-2 py-1 rounded font-bold text-[9px] md:text-xs ${turn === 'PLAYER' ? 'bg-emerald-500 text-white' : turn === 'COUNTER' ? 'bg-red-500 animate-soft-pulse text-white' : 'bg-slate-600 text-slate-300'}`}>
                                {turn === 'PLAYER' ? 'Giliran Anda' : turn === 'COUNTER' ? 'TANGKIS!' : 'Giliran AI'}
                            </div>
                            <button onClick={() => setShowHelp(true)} className="flex items-center justify-center w-7 h-7 bg-blue-500 rounded-full text-white font-black shadow-lg">
                                ?
                            </button>
                        </div>
                    </div>

                    {/* Arena - Dynamic Flex */}
                    <div className="flex-1 flex flex-col my-2 gap-2 min-h-0 relative">
                        
                        {/* POPUP ALERT - OVERLAY FULL ARENA (SEKARANG DI LUAR LOG) */}
                        {pendingAttack && (
                            <div className="absolute inset-0 bg-slate-900/95 z-40 rounded-xl flex flex-col items-center justify-center p-4 border-2 border-red-500 shadow-[0_0_30px_rgba(239,68,68,0.3)] animate-soft-pulse backdrop-blur-sm">
                                
                                {/* TAMPILAN ERROR KETIKA SALAH KARTU PELINDUNG */}
                                {defenseError && (
                                    <div className="absolute top-4 bg-red-600 text-white text-[10px] sm:text-xs font-bold px-4 py-1.5 rounded-full shadow-lg animate-bounce border border-red-400 text-center z-50">
                                        {defenseError}
                                    </div>
                                )}

                                <h2 className="text-lg sm:text-2xl font-black text-red-400 mb-4 sm:mb-6 tracking-widest drop-shadow-md text-center">‚ö†Ô∏è SERANGAN SIBER ‚ö†Ô∏è</h2>
                                
                                <div className="flex flex-row items-center justify-center gap-3 sm:gap-6 w-full max-w-md px-1 sm:px-2">
                                    {/* Kartu Serangan (Di Sebelah Kiri) */}
                                    <div className="shrink-0 transform sm:scale-110 transition-transform duration-300 drop-shadow-2xl">
                                        <Card card={pendingAttack} disabled={true} />
                                    </div>
                                    
                                    {/* Keterangan (Di Sebelah Kanan Kartu) */}
                                    <div className="flex-1 text-left bg-slate-800/90 p-3 sm:p-4 rounded-xl border border-slate-700 shadow-inner">
                                        <p className="text-[10px] sm:text-xs md:text-sm text-slate-300 mb-2 font-medium">
                                            AI menggunakan <span className="text-white font-bold text-xs sm:text-base">{pendingAttack.name}</span>!
                                        </p>
                                        <p className="text-[9px] sm:text-xs text-emerald-400 font-bold mb-3 animate-pulse leading-tight">
                                            Pilih kartu DEFENSE dari tanganmu untuk menangkis!
                                        </p>
                                        <button onClick={skipCounter} className="w-full py-2.5 bg-slate-700 hover:bg-slate-600 active:bg-slate-500 text-white text-[9px] sm:text-xs rounded-lg font-bold border border-slate-500 transition-colors shadow">
                                            Terima Kerusakan (Skip)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* AI Stats - Shrink-0 */}
                        <div className="flex justify-between items-center shrink-0">
                            <div className="bg-slate-800 p-2 rounded-xl border border-slate-700 w-24 sm:w-32 shadow">
                                <h2 className="text-slate-400 text-[8px] md:text-xs font-bold mb-1 truncate">AI OPPONENT</h2>
                                <div className="w-full bg-slate-900 rounded-full h-1.5 md:h-2 mb-1">
                                    <div className="bg-red-500 h-full rounded-full transition-all" style={{ width: `${Math.max(0, aiMH)}%` }}></div>
                                </div>
                                <div className="text-right text-[9px] md:text-xs font-bold">{Math.max(0, aiMH)} MH</div>
                            </div>
                            <div className="flex -space-x-10 sm:-space-x-12 overflow-hidden px-2">
                                {aiHand.map((_, i) => <Card key={i} hidden={true} />)}
                            </div>
                        </div>

                        {/* Battle Log Center - Flex-1 dengan overflow scroll internal */}
                        <div className="flex-1 bg-slate-800 rounded-xl border border-slate-700 p-2 relative flex flex-col min-h-0 overflow-hidden shadow-inner">
                            <h3 className="text-slate-500 text-[10px] sm:text-xs font-bold uppercase tracking-widest shrink-0 border-b border-slate-700 pb-1 mb-1">Battle Log</h3>
                            
                            <div className="flex-1 overflow-y-auto space-y-1 flex flex-col-reverse px-1">
                                {logs.map((log, i) => (
                                    <div key={i} className={`text-[10px] sm:text-xs p-1.5 rounded shrink-0 border-l-2 leading-tight ${i === 0 ? 'bg-slate-700 border-emerald-500 text-white font-medium shadow' : 'bg-transparent border-slate-600 text-slate-400'}`}>
                                        {log}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Player Stats - Shrink-0 */}
                        <div className="flex justify-between items-center shrink-0">
                            <div className="bg-slate-800 p-2 rounded-xl border border-slate-700 w-24 sm:w-32 shadow">
                                <h2 className="text-emerald-400 text-[8px] md:text-xs font-bold mb-1 truncate">SURVIVOR</h2>
                                <div className="w-full bg-slate-900 rounded-full h-1.5 md:h-2 mb-1">
                                    <div className="bg-emerald-400 h-full rounded-full transition-all" style={{ width: `${Math.max(0, playerMH)}%` }}></div>
                                </div>
                                <div className="text-right text-[9px] md:text-xs font-bold">{Math.max(0, playerMH)} MH</div>
                            </div>
                            <div className="flex gap-1">
                                <button onClick={() => drawCard(true)} disabled={turn !== 'PLAYER' || playerHand.length >= 6} className="bg-blue-600 active:bg-blue-500 disabled:opacity-50 px-3 py-1.5 rounded font-bold text-[9px] sm:text-xs">
                                    Draw
                                </button>
                                <button onClick={endTurn} disabled={turn !== 'PLAYER'} className="bg-slate-600 active:bg-slate-500 disabled:opacity-50 px-3 py-1.5 rounded font-bold text-[9px] sm:text-xs">
                                    End
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Player Hand - Shrink-0 - Tinggi diperbesar agar kartu muat */}
                    <div className="shrink-0 h-44 sm:h-56 md:h-60 bg-slate-800 rounded-t-xl border-t border-slate-700 p-2 relative flex flex-col shadow-2xl">
                        <div className="absolute -top-2 left-1/2 transform -translate-x-1/2 bg-slate-900 px-3 py-0.5 rounded-full border border-slate-600 text-[8px] md:text-[10px] font-bold text-slate-300 shadow z-10">
                            Tangan ({playerHand.length}/6)
                        </div>
                        <div className="flex-1 flex overflow-x-auto hide-scrollbar snap-x px-1 pt-3 pb-2 w-full items-center">
                            <div className="flex flex-nowrap mx-auto">
                                {playerHand.map((card, i) => (
                                    <div 
                                        key={card.uniqueId || i} 
                                        className={`flex-shrink-0 snap-center relative group ${i !== 0 ? '-ml-6 sm:-ml-4' : ''} hover:z-50`}
                                    >
                                        <Card 
                                            card={card} 
                                            onClick={() => playCard(card, i)}
                                            disabled={(turn === 'AI') || (turn === 'COUNTER' && card.type !== CARD_TYPES.DEFENSE)}
                                        />
                                    </div>
                                ))}
                            </div>
                            {playerHand.length === 0 && (
                                <div className="text-slate-500 text-[9px] sm:text-xs italic w-full text-center">Tangan Kosong. Draw Kartu.</div>
                            )}
                        </div>
                    </div>

                    {/* Modal Tutorial / Bantuan */}
                    {showHelp && (
                        <div className="fixed inset-0 bg-slate-900/95 z-[100] flex flex-col items-center justify-center p-4">
                            <div className="bg-slate-800 rounded-xl w-full max-w-md mx-auto border border-slate-600 shadow-2xl relative flex flex-col max-h-[90dvh]">
                                <button onClick={() => setShowHelp(false)} className="absolute top-3 right-3 w-8 h-8 flex items-center justify-center bg-slate-700 hover:bg-red-500 rounded-full text-white font-bold z-10 transition">‚úï</button>
                                
                                {/* Header Modal */}
                                <div className="p-4 sm:p-5 border-b border-slate-600 shrink-0">
                                    <h2 className="text-lg sm:text-xl font-black text-emerald-400">Panduan CYBERIA</h2>
                                </div>
                                
                                {/* Isi Konten Modal (Bisa di-scroll) */}
                                <div className="p-4 sm:p-5 overflow-y-auto space-y-6 text-[10px] sm:text-xs md:text-sm text-slate-300">
                                    
                                    {/* Section 0: Siapa Lawanmu? */}
                                    <div className="bg-slate-900/70 p-3 rounded-lg border border-slate-700">
                                        <h3 className="font-bold text-cyan-400 mb-2 flex items-center gap-1.5"><span className="text-base">ü§ñ</span> Siapa Lawanmu?</h3>
                                        <div className="flex justify-center mb-3">
                                            <div className="bg-slate-800 p-2 rounded-xl border border-slate-700 shadow flex items-center gap-2">
                                                <div className="text-2xl">üëæ</div>
                                                <div className="text-left">
                                                    <h2 className="text-slate-400 text-[10px] font-bold">AI OPPONENT</h2>
                                                    <div className="text-xs font-bold text-white">Sistem Anonim</div>
                                                </div>
                                            </div>
                                        </div>
                                        <p>Dalam dimensi virtual ini, lawanmu disebut <strong>AI (Artificial Intelligence)</strong>. AI bertindak sebagai simulasi sistem komputer yang meniru perilaku penyerang, penyebar hoax, dan <em>cyberbully</em> di dunia nyata.</p>
                                    </div>

                                    {/* Section 1: MH */}
                                    <div>
                                        <h3 className="font-bold text-white mb-2 flex items-center gap-1.5"><span className="text-base">‚ù§Ô∏è</span> Kesehatan Mental (MH)</h3>
                                        <div className="bg-slate-900 p-3 rounded-lg border border-slate-700 mb-2 flex flex-col gap-3">
                                            <div className="flex items-center gap-2">
                                                <span className="text-[10px] w-12 text-right font-bold text-slate-400">AI MH</span>
                                                <div className="w-full bg-slate-800 rounded-full h-2.5 shadow-inner"><div className="bg-red-500 h-full rounded-full w-[80%]"></div></div>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <span className="text-[10px] w-12 text-right font-bold text-emerald-400">Your MH</span>
                                                <div className="w-full bg-slate-800 rounded-full h-2.5 shadow-inner"><div className="bg-emerald-400 h-full rounded-full w-[50%]"></div></div>
                                            </div>
                                        </div>
                                        <p>Lihat kotak indikator di layar. <strong className="text-emerald-400">Bar Hijau</strong> adalah MH kamu (Survivor), dan <strong className="text-red-400">Bar Merah</strong> adalah MH AI. Buat MH AI menjadi 0 untuk menang, dan jangan biarkan MH kamu habis!</p>
                                    </div>

                                    {/* Section 2: Draw & End */}
                                    <div>
                                        <h3 className="font-bold text-blue-400 mb-2 flex items-center gap-1.5"><span className="text-base">üÉè</span> Tombol Draw & End</h3>
                                        <div className="flex justify-center gap-3 mb-3 bg-slate-900 py-3 rounded-lg border border-slate-700">
                                            <button className="bg-blue-600 px-4 py-2 rounded font-bold text-xs text-white shadow-lg pointer-events-none">Draw</button>
                                            <button className="bg-slate-600 px-4 py-2 rounded font-bold text-xs text-white shadow-lg pointer-events-none">End</button>
                                        </div>
                                        <p>Klik tombol <strong>Draw</strong> untuk mengambil 1 kartu dari deck ke tanganmu (tangan maksimal berisi 6 kartu). Jika kamu sudah tidak ingin mengeluarkan kartu lagi, klik <strong>End</strong> untuk menyerahkan giliran ke AI.</p>
                                    </div>

                                    {/* Section 3: Menyerang */}
                                    <div>
                                        <h3 className="font-bold text-red-400 mb-2 flex items-center gap-1.5"><span className="text-base">‚öîÔ∏è</span> Cara Menyerang (ATTACK)</h3>
                                        <div className="flex justify-center mb-[-10px] mt-[-10px]">
                                            <div className="scale-75"><Card card={CARD_DB.find(c => c.id === 'a2')} disabled={true} /></div>
                                        </div>
                                        <p>Saat indikator menunjukkan "Giliran Anda", klik <strong>Kartu ATTACK</strong> di tanganmu. Serangan otomatis akan memotong poin MH AI berdasarkan tingkat keparahannya.</p>
                                        <div className="mt-2 p-2 bg-slate-900/80 rounded-lg border border-slate-700 text-[9px] sm:text-[10px] leading-relaxed">
                                            <span className="text-red-400 font-bold block mb-1">Daftar Kartu Serangan (ATTACK):</span> 
                                            <span className="text-slate-400">Flaming, Insulting, Spamming Hate, Threatening, Slurring, Mocking, Impersonation, Account Hijack, Doxing, Catfishing, Stalking, Privacy Breach, Shaming Photo, Meme-ing, Deepfake, Live Shaming, Status Mockery, Video Mocking, Group Kick-out, Silent Treat, Blacklisting, Exclusion, Hate Campaign, Voting Bully, Hoax Spreading, Cyber-baiting, Griefing, Dogpiling, False Report, Peer Pressure.</span>
                                        </div>
                                    </div>

                                    {/* Section 4: Bertahan */}
                                    <div className="bg-slate-900 p-3 rounded-lg border border-slate-700">
                                        <h3 className="font-bold text-emerald-400 mb-2 flex items-center gap-1.5"><span className="text-base">üõ°Ô∏è</span> Cara Bertahan (DEFENSE)</h3>
                                        <p className="mb-2">Saat AI balik menyerang, peringatan ‚ö†Ô∏è akan muncul berkedip di layar. Segera klik <strong>Kartu DEFENSE (Action Tool)</strong> di tanganmu yang memiliki label <em>"Bisa Menangkal"</em> sesuai dengan kategori serangan AI.</p>
                                        <div className="p-2 bg-slate-800 rounded-lg border border-slate-600 text-[9px] sm:text-[10px] leading-relaxed mb-3">
                                            <span className="text-emerald-400 font-bold block mb-1">Daftar Kartu Pelindung (DEFENSE):</span> 
                                            <span className="text-slate-300">Kartu Lapor, Kartu Blokir, Kartu Privasi, Screenshot, Restrict, Turn Off Comm, Pass Protect.</span>
                                        </div>
                                        <div className="flex items-center justify-center gap-2">
                                            <div className="scale-75 origin-right"><Card card={CARD_DB.find(c => c.id === 'a1')} disabled={true} /></div>
                                            <span className="text-base sm:text-lg shrink-0 text-white">‚û°Ô∏è</span>
                                            <div className="scale-75 origin-left"><Card card={CARD_DB.find(c => c.id === 'd1')} disabled={true} /></div>
                                        </div>
                                        <p className="text-[9px] sm:text-[10px] text-center mt-[-10px] text-slate-400">Contoh: Flaming (Agresi Verbal) ditangkis oleh Kartu Blokir.</p>
                                    </div>

                                    {/* Section 5: Healing */}
                                    <div>
                                        <h3 className="font-bold text-yellow-400 mb-2 flex items-center gap-1.5"><span className="text-base">üíñ</span> Pemulihan Mental (WISDOM)</h3>
                                        <div className="flex justify-center mb-[-10px] mt-[-10px]">
                                            <div className="scale-75"><Card card={CARD_DB.find(c => c.id === 'w1')} disabled={true} /></div>
                                        </div>
                                        <p>Saat "Giliran Anda", kamu bisa mengklik <strong>Kartu WISDOM</strong> untuk beristirahat dan memulihkan poin MH kamu sendiri.</p>
                                        <div className="mt-2 p-2 bg-slate-900/80 rounded-lg border border-slate-700 text-[9px] sm:text-[10px] leading-relaxed">
                                            <span className="text-yellow-400 font-bold block mb-1">Daftar Kartu Pemulihan (WISDOM):</span> 
                                            <span className="text-slate-400">Kartu Support, Verifikasi, Literasi, Think First, Digital Detox, Berani Bicara, Kartu Pause, Netizen Hijau.</span>
                                        </div>
                                    </div>

                                    {/* Section 6: Pesan Moral & Kesimpulan */}
                                    <div className="bg-gradient-to-br from-indigo-900/80 to-purple-900/80 p-3 sm:p-4 rounded-xl border border-indigo-400/50 shadow-lg mt-4 relative overflow-hidden">
                                        <div className="absolute top-0 right-0 p-2 opacity-20 text-4xl pointer-events-none">üí°</div>
                                        <h3 className="font-bold text-indigo-300 mb-2 flex items-center gap-1.5"><span className="text-base">‚ú®</span> Makna Simulasi</h3>
                                        <p className="text-slate-200 leading-relaxed text-[10px] sm:text-xs">
                                            Dari daftar kartu di atas, kita bisa melihat betapa banyaknya bentuk kejahatan siber (<strong>cyberbullying</strong>) yang mengintai. Seringkali, cara mereka menyerang terasa jauh lebih banyak daripada cara kita melawan. 
                                            <br/><br/>
                                            Namun jangan takut! Dengan <strong>mengenali jenis-jenis ancaman tersebut</strong> dan mengerti <strong>cara bertahan serta memulihkan diri</strong> melalui simulasi ini, kamu sudah selangkah lebih siap. Pengetahuan sekecil apa pun yang kamu pelajari di sini akan menjadi tameng mental yang sangat berharga untuk melindungi dirimu dan teman-temanmu di kehidupan nyata. <em>Stay safe and be kind!</em>
                                        </p>
                                    </div>

                                </div>

                                {/* Footer Modal */}
                                <div className="p-4 border-t border-slate-600 shrink-0">
                                    <button onClick={() => setShowHelp(false)} className="w-full py-2.5 bg-emerald-600 active:bg-emerald-500 rounded-lg text-white font-bold shadow transition">Saya Mengerti!</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
